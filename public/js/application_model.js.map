{"version":3,"sources":["application_model.js"],"names":[],"mappings":";;AAAA,OAAO,CACH,UADG,EAEH,kBAFG,CAAP,EAGA,UACI,MADJ,EAEI,cAFJ,EAGA;AACA;;;;AADA;AAKA,QAAI,eAAe,SAAf,YAAe,CAAS,IAAT,EAAe,IAAf,EAAqB;AACpC,YAAI,OAAO,IAAP,CADgC;AAEpC,aAAK,IAAL,GAAY,GAAG,UAAH,CAAc,IAAd,CAAZ,CAFoC;AAGpC,aAAK,IAAL,GAAY,GAAG,UAAH,CAAc,IAAd,CAAZ,CAHoC;AAIpC,aAAK,SAAL,GAAiB,GAAG,UAAH,CAAc,IAAI,OAAO,UAAP,CAAkB,KAAK,QAAL,EAAtB,CAAd,CAAjB,CAJoC;;AAMpC,aAAK,OAAL,GAAe,IAAI,eAAe,aAAf,EAAnB,CANoC;;AAQpC,aAAK,WAAL,GAAmB,UAAS,KAAT,EAAgB;AAC/B,iBAAK,SAAL,GAAiB,QAAjB,CAA0B,KAA1B,EAD+B;SAAhB,CARiB;;AAYpC,aAAK,cAAL,GAAsB,UAAS,QAAT,EAAmB;AACrC,mBAAO,KAAK,SAAL,GAAiB,QAAjB,CAA0B,MAA1B,CAAiC,UAAS,CAAT,EAAY;AAC/C,uBAAO,EAAE,GAAF,OAAY,QAAZ,CADwC;aAAZ,CAAxC,CADqC;SAAnB;;;AAZc,YAmBpC,CAAK,OAAL,CAAa,SAAb,CAAuB,KAAK,QAAL,EAAvB,EAAwC;AACpC,6BAAiB,uBAAS,GAAT,EAAc;AAC3B,qBAAK,IAAL,GAAY,MAAZ,CAAmB,IAAI,OAAO,WAAP,CAAmB,IAAI,MAAJ,CAAW,KAAX,CAA1C,EAD2B;aAAd;SADrB,EAnBoC;;AAyBpC,YAAI,CAAC,IAAD,IAAS,CAAC,KAAK,UAAL,EAAD,EACT,OADJ;;AAGA,UAAE,IAAF,CAAO;AACH,kBAAM,KAAN;AACA,iBAAK,SAAS,WAAT,CAAqB,mBAArB,CAAyC,cAAzC,CAAwD,KAAK,UAAL,EAAxD,EAA2E,GAA3E;AACL,qBAAS;AACL,wBAAQ,kBAAR;aADJ;AAGA,mBAAO,eAAS,CAAT,EAAY;AAAE,wBAAQ,KAAR,CAAc,CAAd,EAAF;aAAZ;SANX,EAOG,IAPH,CAOQ,UAAS,MAAT,EAAiB;AACrB,iBAAK,SAAL,GAAiB,QAAjB,CAA0B,CAAC,UAAU,EAAV,CAAD,CAAe,GAAf,CAAmB,OAAO,WAAP,CAAmB,QAAnB,CAA7C,EADqB;SAAjB,CAPR;;;AA5BoC,YAwCpC,CAAK,OAAL,CAAa,mBAAb,CAAiC,KAAK,QAAL,EAAjC,EAAkD;AAC9C,6BAAiB,uBAAS,GAAT,EAAc;AAC3B,oBAAI,gBAAgB,KAAK,cAAL,CAAoB,IAAI,IAAJ,CAApC,CADuB;AAE3B,oBAAI,cAAc,MAAd,EAAsB;AACtB,kCAAc,CAAd,EAAiB,MAAjB,CAAwB,OAAO,WAAP,CAAmB,QAAnB,CAA4B,IAAI,MAAJ,CAApD,EADsB;AAEtB,yBAAK,WAAL,CAAiB,cAAc,CAAd,CAAjB,EAFsB;iBAA1B;aAFa;AAOjB,0BAAc,oBAAS,GAAT,EAAc;AACxB,qBAAK,WAAL,CAAiB,OAAO,WAAP,CAAmB,QAAnB,CAA4B,IAAI,KAAJ,CAA7C,EADwB;aAAd;AAGd,4BAAgB,sBAAS,GAAT,EAAc;AAC1B,qBAAK,cAAL,CAAoB,IAAI,KAAJ,CAApB,CAD0B;aAAd;SAXpB,EAxCoC;KAArB,CALnB;;AA8DA,QAAI,cAAc,SAAd,WAAc,GAAW;AACzB,eAAO,OAAO,SAAP,CAAiB,QAAjB,CAA0B,OAAO,eAAP,CAAjC,CADyB;KAAX,CA9DlB;;AAkEA,WAAO;AACH,sBAAc,YAAd;AACA,qBAAa,WAAb;KAFJ,CAlEA;CAHA,CAHA","file":"application_model.js","sourcesContent":["define([\n    './models',\n    './stream_manager'],\nfunction(\n    models,\n    stream_manager)\n{\n\"use-strict\";\n\n/**\n*/\nvar AppViewModel = function(user, page) {\n    var self = this;\n    self.user = ko.observable(user);\n    self.page = ko.observable(page);\n    self.favorites = ko.observable(new models.Collection(user.userName()));\n\n    self.manager = new stream_manager.StreamManager();\n\n    self.addFavorite = function(child) {\n        self.favorites().addChild(child);\n    };\n\n    self.removeFavorite = function(childUri) {\n        return self.favorites().children.remove(function(x) {\n             return x.uri() === childUri;\n         });\n    };\n\n    // Subscribe to user status updates\n    self.manager.subscribe(user.userName(), {\n        'StatusUpdated': function(msg) {\n            self.user().status(new models.StatusModel(msg.status.color));\n        }\n    });\n\n    if (!user || !user.rootStream())\n        return;\n\n    $.ajax({\n        type: \"GET\",\n        url: jsRoutes.controllers.StreamApiController.apiGetChildren(user.rootStream()).url,\n        headers: {\n            accept: \"application/json\"\n        },\n        error: function(e) { console.error(e); }\n    }).done(function(result) {\n        self.favorites().children((result || []).map(models.StreamModel.fromJson));\n    });\n\n     // Subscribe to user collection updates\n    self.manager.subscribeCollection(user.userName(), {\n        'StatusUpdated': function(msg) {\n            var existingChild = self.removeFavorite(msg.from);\n            if (existingChild.length) {\n                existingChild[0].status(models.StatusModel.fromJson(msg.status));\n                self.addFavorite(existingChild[0]);\n            }\n        },\n        'ChildAdded': function(msg) {\n            self.addFavorite(models.StreamModel.fromJson(msg.child));\n        },\n        'ChildRemoved': function(msg) {\n            self.removeFavorite(msg.child);\n        }\n    });\n};\n\nvar initialUser = function() {\n    return models.UserModel.fromJson(window.initialUserData);\n};\n\nreturn {\n    AppViewModel: AppViewModel,\n    initialUser: initialUser\n};\n\n});"],"sourceRoot":"/source/"}