{"version":3,"sources":["stream_index.js"],"names":[],"mappings":"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","file":"stream_index.js","sourcesContent":["require([\n    './models',\n    './stream_manager',\n    './application_model',\n    './shared'],\nfunction(\n    models,\n    stream_manager,\n    application_model,\n    shared)\n{\n\"use-strict\";\n\n/**\n*/\nvar StreamIndexViewModel = function(user, results) {\n    var self = this;\n    application_model.AppViewModel.call(this, user);\n\n    self.user = ko.observable(user);\n    self.results = ko.observableArray(results);\n    self.query = ko.observable(undefined);\n};\n\nvar normalizeQuery = function(query) {\n    return decodeURI(query).replace(/\\+/g, ' ').trim();\n};\n\nvar updateSearchResultsForQuery = function(model, query) {\n    query = normalizeQuery(query);\n    $('.list-loading').removeClass('hidden');\n    $.ajax({\n        type: \"GET\",\n        url: jsRoutes.controllers.StreamApiController.apiGetStreams().url,\n        data: {\n            'query': query\n        },\n        headers: {\n            accept: \"application/json\"\n        },\n        error: function() {\n            $('.list-loading').addClass('hidden');\n            // todo: display error msg\n        }\n    }).done(function(result) {\n        $('.list-loading').addClass('hidden');\n        model.query(query);\n        model.results((result || []).map(models.StreamModel.fromJson));\n    });\n};\n\nvar updateSearchResults = function(model) {\n    return updateSearchResultsForQuery(\n        model,\n        normalizeQuery($('#stream-search-form input').val()));\n};\n\nvar getQueryFromQueryString = function() {\n    var qs = shared.getQueryString().query;\n    return (qs ? normalizeQuery(qs[0]) : '');\n};\n\nvar updateFromQueryString = function(model) {\n    var query = getQueryFromQueryString();\n    $('#stream-search-form input').val(query);\n    updateSearchResultsForQuery(model, query);\n};\n\n$(function(){\n    var model = new StreamIndexViewModel(\n        application_model.initialUser(),\n        []);\n\n    $('#stream-search-form button').click(function(e) {\n        e.preventDefault();\n        updateSearchResults(model);\n    });\n\n    $('#stream-search-form input').keypress(function(e) {\n        if (e.keyCode === 13) {\n            updateSearchResults(model);\n            e.preventDefault();\n        }\n    });\n\n    model.results.subscribe(function(results) {\n        if (results.length)\n            $('.no-results').addClass('hidden');\n        else\n            $('.no-results').removeClass('hidden');\n    });\n\n    model.query.subscribe(function(query) {\n        var currentQuery = (window.history.state ? window.history.state.query : undefined);\n        if (query === currentQuery)\n            return;\n        var path = window.location.origin + window.location.pathname;\n        var url = (query ? path + \"?query=\" + encodeURIComponent(query) : path);\n        window.history.pushState({ query: query }, '', url);\n    });\n\n    window.onpopstate = function(e) {\n        updateFromQueryString(model);\n    };\n\n    window.history.replaceState({ query: getQueryFromQueryString() }, '', window.location.href);\n\n    updateFromQueryString(model);\n\n    ko.applyBindings(model);\n});\n\n});"],"sourceRoot":"/source/"}