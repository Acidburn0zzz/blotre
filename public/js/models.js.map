{"version":3,"sources":["models.js"],"names":[],"mappings":"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","file":"models.js","sourcesContent":["define([], function() {\n\nvar slice = Function.prototype.call.bind(Array.prototype.slice);\n\nvar DEFAULT_COLOR = '#777777';\n\n/**\n*/\nvar normalizeUri = function(uri) {\n    return decodeURI(uri)\n        .trim()\n        .toLowerCase()\n        .replace(' ', '/');\n};\n\n/**\n    Pretty prints a data.\n*/\nvar dateToDisplay = (function(){\n    var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\n    var pad = function(min, input) {\n        input += '';\n        while (input.length < min)\n            input = '0' + input;\n        return input;\n    };\n\n    return function(date) {\n        if (!date)\n            return '-';\n\n        return months[date.getMonth()] + ' ' + pad(2, date.getDate()) + ', ' + date.getFullYear() + ' ' +\n            pad(2, date.getHours()) + ':' + pad(2, date.getMinutes()) + '.' +\n            pad(2, date.getSeconds()) + pad(3, date.getMilliseconds());\n    };\n}());\n\n/**\n*/\nvar StatusModel = function(color) {\n   var self = this;\n   self.color = ko.observable(color);\n};\n\nStatusModel.empty = function() {\n    return new StatusModel(DEFAULT_COLOR);\n};\n\nStatusModel.fromJson = function(data) {\n    return new StatusModel(data && data.color);\n};\n\n/**\n*/\nvar TagModel = function(value) {\n   var self = this;\n   self.value = ko.observable(value);\n\n    self.url = ko.computed(function() {\n       return jsRoutes.controllers.Stream.getTag(self.value()).url;\n   });\n};\n\n/**\n*/\nvar StreamModel = function(id, name, uri, status, updated, tags) {\n    var self = this;\n    self.id = ko.observable(id);\n    self.name = ko.observable(name || '');\n    self.uri = ko.observable(uri || '');\n    self.status = ko.observable(status || StatusModel.empty());\n    self.updated = ko.observable(updated);\n    self.tags = ko.observableArray(tags || []);\n\n    self.url = ko.computed(function() {\n        return jsRoutes.controllers.Stream.getStream(self.uri()).url;\n    });\n\n    self.color = ko.computed(function() {\n        var status = self.status();\n        return (status ? status.color() : DEFAULT_COLOR);\n    });\n\n    self.setColor = function(color) {\n        var status = self.status() || StatusModel.empty();\n        status.color(color);\n        self.status(status);\n    };\n\n    self.displayUpdated = ko.computed(function() {\n        return dateToDisplay(self.updated());\n    });\n\n    self.isOwner = function(user) {\n        var ownerUri = normalizeUri(user.userName());\n        return (ownerUri === self.uri() || self.uri().indexOf(ownerUri + '/') === 0);\n    };\n};\n\nStreamModel.fromJson = function(data) {\n    return new StreamModel(\n        data && data.id,\n        data && data.name,\n        data && data.uri,\n        StatusModel.fromJson(data && data.status),\n        new Date(data && data.updated),\n        (data && data.tags || []).map(function(x){ return new TagModel(x.tag); }));\n};\n\n/**\n*/\nvar UserModel = function(userName, status, rootStream) {\n    var self = this;\n    self.userName = ko.observable(userName || '');\n    self.status = ko.observable(status || StatusModel.empty());\n    self.rootStream = ko.observable(rootStream);\n\n    self.color = ko.computed(function() {\n        var status = self.status();\n        return (status ? status.color() : DEFAULT_COLOR);\n    });\n};\n\nUserModel.fromJson = function(data) {\n    return new UserModel(\n        data && data.userName,\n        StatusModel.fromJson(data && data.status),\n        data && data.rootStream);\n};\n\n/**\n*/\nvar Collection = function(uri) {\n    var self = this;\n    self.uri = ko.observable(uri);\n    self.children = ko.observableArray();\n\n     self.addChild = function(child) {\n       self.children.remove(function(x) {\n            return x.uri() === child.uri();\n        });\n        self.children.unshift(child);\n    };\n};\n\nreturn {\n    DEFAULT_COLOR: DEFAULT_COLOR,\n\n    normalizeUri: normalizeUri,\n\n    StatusModel: StatusModel,\n    StreamModel: StreamModel,\n    TagModel: TagModel,\n\n    UserModel: UserModel,\n    Collection: Collection\n};\n\n});"],"sourceRoot":"/source/"}